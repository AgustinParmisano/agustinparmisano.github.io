<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Snake Arcoíris</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background: #000;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			font-family: Arial, sans-serif;
			touch-action: none;
		}
		#gameContainer {
			position: relative;
			text-align: center;
		}
		#gameCanvas {
			border: 2px solid #333;
			background: #111;
			display: block;
			touch-action: none;
		}
		#score {
			color: #fff;
			font-size: 24px;
			margin-bottom: 10px;
			text-shadow: 0 0 10px rgba(255,255,255,0.5);
		}
		#gameOver {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: #fff;
			font-size: 32px;
			text-shadow: 0 0 20px rgba(255,255,255,0.8);
			display: none;
		}
		#instructions {
			color: #888;
			font-size: 14px;
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<div id="gameContainer">
		<div id="score">Puntuación: 0</div>
		<canvas id="gameCanvas"></canvas>
		<div id="gameOver">¡Juego Terminado!<br><span style="font-size: 18px;">Toca para jugar de nuevo</span></div>
		<div id="instructions">Usa las flechas o desliza el dedo para mover</div>
	</div>

	<script>
		var canvas = document.getElementById('gameCanvas');
		var ctx = canvas.getContext('2d');
		var scoreElement = document.getElementById('score');
		var gameOverElement = document.getElementById('gameOver');

		// Configuración del juego
		var gridSize = 20;
		var tileCount;

		// Ajustar tamaño del canvas
		function resizeCanvas() {
			var maxWidth = window.innerWidth - 20;
			var maxHeight = window.innerHeight - 150;
			var size = Math.min(maxWidth, maxHeight, 600);
			canvas.width = size;
			canvas.height = size;
			tileCount = canvas.width / gridSize;
		}
		resizeCanvas();
		window.addEventListener('resize', resizeCanvas);

		// Serpiente
		var snake = [];
		var dx = 0;
		var dy = 0;

		// Comida (triángulo)
		var food = {
			x: 0,
			y: 0
		};

		// Función para inicializar la serpiente en el centro
		function initSnake() {
			var centerX = Math.floor(tileCount / 2);
			var centerY = Math.floor(tileCount / 2);
			snake = [{x: centerX, y: centerY}];
		}

		// Variables del juego
		var score = 0;
		var gameRunning = true;
		var hue = 0; // Para el color arcoíris

		// Función para convertir HSL a hexadecimal
		function hslToHex(h, s, l) {
			h /= 360;
			s /= 100;
			l /= 100;
			var r, g, b;
			if (s === 0) {
				r = g = b = l;
			} else {
				var hue2rgb = function(p, q, t) {
					if (t < 0) t += 1;
					if (t > 1) t -= 1;
					if (t < 1/6) return p + (q - p) * 6 * t;
					if (t < 1/2) return q;
					if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
					return p;
				};
				var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
				var p = 2 * l - q;
				r = hue2rgb(p, q, h + 1/3);
				g = hue2rgb(p, q, h);
				b = hue2rgb(p, q, h - 1/3);
			}
			return '#' + Math.round(r * 255).toString(16).padStart(2, '0') +
				   Math.round(g * 255).toString(16).padStart(2, '0') +
				   Math.round(b * 255).toString(16).padStart(2, '0');
		}

		// Función para dibujar un triángulo
		function drawTriangle(x, y, color) {
			var centerX = x * gridSize + gridSize / 2;
			var centerY = y * gridSize + gridSize / 2;
			var size = gridSize * 0.6;

			ctx.fillStyle = color;
			ctx.beginPath();
			ctx.moveTo(centerX, centerY - size / 2);
			ctx.lineTo(centerX - size / 2, centerY + size / 2);
			ctx.lineTo(centerX + size / 2, centerY + size / 2);
			ctx.closePath();
			ctx.fill();
		}

		// Función para dibujar la serpiente
		function drawSnake() {
			snake.forEach(function(segment, index) {
				var segmentHue = (hue + index * 5) % 360; // Color diferente para cada segmento
				var color = hslToHex(segmentHue, 100, 50);
				
				ctx.fillStyle = color;
				ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);
				
				// Agregar un borde más brillante
				ctx.strokeStyle = hslToHex(segmentHue, 100, 70);
				ctx.lineWidth = 1;
				ctx.strokeRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);
			});
		}

		// Función para generar nueva comida
		function generateFood() {
			do {
				food.x = Math.floor(Math.random() * tileCount);
				food.y = Math.floor(Math.random() * tileCount);
			} while (snake.some(function(segment) {
				return segment.x === food.x && segment.y === food.y;
			}));
		}

		// Función para mover la serpiente
		function moveSnake() {
			if (!gameRunning) return;

			// No mover si no hay dirección establecida
			if (dx === 0 && dy === 0) return;

			var head = {x: snake[0].x + dx, y: snake[0].y + dy};

			// Detectar colisiones con las paredes
			if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
				gameOver();
				return;
			}

			// Detectar colisiones consigo misma (excepto cuando está quieta)
			if (snake.some(function(segment, index) {
				// No comparar con el primer segmento (la cabeza actual)
				return index > 0 && segment.x === head.x && segment.y === head.y;
			})) {
				gameOver();
				return;
			}

			snake.unshift(head);

			// Comer comida
			if (head.x === food.x && head.y === food.y) {
				score += 10;
				scoreElement.textContent = 'Puntuación: ' + score;
				generateFood();
			} else {
				snake.pop();
			}
		}

		// Función de juego terminado
		function gameOver() {
			gameRunning = false;
			gameOverElement.style.display = 'block';
		}

		// Función para reiniciar el juego
		function resetGame() {
			initSnake();
			dx = 0;
			dy = 0;
			score = 0;
			scoreElement.textContent = 'Puntuación: 0';
			gameRunning = true;
			gameOverElement.style.display = 'none';
			generateFood();
		}

		// Controles de teclado
		var keyDirection = {
			'ArrowUp': {x: 0, y: -1},
			'ArrowDown': {x: 0, y: 1},
			'ArrowLeft': {x: -1, y: 0},
			'ArrowRight': {x: 1, y: 0}
		};

		document.addEventListener('keydown', function(e) {
			if (!gameRunning && e.key !== ' ') {
				return;
			}
			
			if (e.key === ' ' && !gameRunning) {
				resetGame();
				return;
			}

			var direction = keyDirection[e.key];
			if (direction && (dx !== -direction.x || dy !== -direction.y)) {
				dx = direction.x;
				dy = direction.y;
				e.preventDefault();
			}
		});

		// Controles táctiles (swipe)
		var touchStartX = 0;
		var touchStartY = 0;
		var touchEndX = 0;
		var touchEndY = 0;

		canvas.addEventListener('touchstart', function(e) {
			if (!gameRunning) {
				resetGame();
				return;
			}
			e.preventDefault();
			touchStartX = e.touches[0].clientX;
			touchStartY = e.touches[0].clientY;
		}, { passive: false });

		canvas.addEventListener('touchend', function(e) {
			if (!gameRunning) return;
			e.preventDefault();
			touchEndX = e.changedTouches[0].clientX;
			touchEndY = e.changedTouches[0].clientY;
			
			var deltaX = touchEndX - touchStartX;
			var deltaY = touchEndY - touchStartY;
			var minSwipeDistance = 30;

			if (Math.abs(deltaX) > Math.abs(deltaY)) {
				// Swipe horizontal
				if (Math.abs(deltaX) > minSwipeDistance) {
					if (deltaX > 0 && dx !== -1) {
						dx = 1;
						dy = 0;
					} else if (deltaX < 0 && dx !== 1) {
						dx = -1;
						dy = 0;
					}
				}
			} else {
				// Swipe vertical
				if (Math.abs(deltaY) > minSwipeDistance) {
					if (deltaY > 0 && dy !== -1) {
						dx = 0;
						dy = 1;
					} else if (deltaY < 0 && dy !== 1) {
						dx = 0;
						dy = -1;
					}
				}
			}
		}, { passive: false });

		// También permitir reinicio tocando el canvas cuando el juego terminó
		canvas.addEventListener('click', function(e) {
			if (!gameRunning) {
				resetGame();
			}
		});

		// Bucle principal del juego
		function gameLoop() {
			// Actualizar color arcoíris
			hue = (hue + 3) % 360;

			// Limpiar canvas
			ctx.fillStyle = '#111';
			ctx.fillRect(0, 0, canvas.width, canvas.height);

			// Dibujar comida (triángulo)
			drawTriangle(food.x, food.y, hslToHex((hue + 180) % 360, 100, 60));

			// Mover y dibujar serpiente
			moveSnake();
			drawSnake();

			// Continuar el bucle
			setTimeout(gameLoop, 150);
		}

		// Iniciar el juego
		initSnake();
		generateFood();
		gameLoop();
	</script>
</body>
</html>

